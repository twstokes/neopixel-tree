substitutions:
  name: neopixel-tree
  friendly_name: "NeoPixel Tree"
  num_leds: "106"
  data_pin: "18"

esphome:
  name: ${name}
  friendly_name: ${friendly_name}
  project:
    name: twstokes.neopixel_tree
    version: "2.0.0-esphome"
  comment: "ESPHome rewrite of the NeoPixel Tree firmware"

esp32:
  board: esp32dev
  framework:
    type: arduino

logger:

api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: none
  manual_ip:
    static_ip: !secret static_ip
    gateway: !secret gateway
    subnet: !secret subnet
  ap:
    ssid: "${friendly_name} Fallback"
    password: !secret fallback_ap_password

mdns:
  disabled: false

light:
  - platform: neopixelbus
    id: tree_light
    name: "${friendly_name}"
    pin: GPIO${data_pin}
    type: GRB
    variant: WS2812
    num_leds: ${num_leds}
    gamma_correct: 2.8
    default_transition_length: 0.3s
    effects:
      - addressable_rainbow:
          name: "Rainbow Flow"
          speed: 8
          width: 30
      - addressable_lambda:
          name: "Rainbow Cycle"
          update_interval: 20ms
          lambda: |-
            static uint8_t offset = 0;
            offset += 4;  // speed
            const float stride = 255.0f / it.size();
            for (int i = 0; i < it.size(); i++) {
              uint8_t hue = uint8_t(offset + (stride * i));
              it[i] = ESPHSVColor(hue, 255, 255);
            }
      - addressable_lambda:
          name: "Theater Chase"
          update_interval: 50ms
          lambda: |-
            static uint8_t offset = 0;
            offset = (offset + 1) % 3;
            for (int i = 0; i < it.size(); i++) {
              if ((i + offset) % 3 == 0) {
                it[i] = current_color;
              } else {
                it[i] = Color::BLACK;
              }
            }
      - addressable_lambda:
          name: "Candy Cane"
          update_interval: 30ms
          lambda: |-
            static uint16_t start = 0;
            start++;
            for (int i = 0; i < it.size(); i++) {
              bool white = ((i + (start / 3)) % 8) < 4;
              if (white) {
                it[i] = Color(255, 255, 255);
              } else {
                it[i] = Color(255, 32, 32);
              }
            }
      - addressable_fireworks:
          name: "Firefly Sparkle"
          update_interval: 20ms
          spark_probability: 10%
          use_random_color: true
          fade_out_rate: 120
      - addressable_random_twinkle:
          name: "Random Sparkle"
          twinkle_probability: 3%
          progress_interval: 6ms

sensor:
  - platform: uptime
    name: "${friendly_name} Uptime"
  - platform: wifi_signal
    name: "${friendly_name} WiFi RSSI"
    update_interval: 60s

text_sensor:
  - platform: wifi_info
    ip_address:
      name: "${friendly_name} IP"
    ssid:
      name: "${friendly_name} SSID"
  - platform: version
    name: "${friendly_name} ESPHome Version"

button:
  - platform: restart
    name: "${friendly_name} Restart"
